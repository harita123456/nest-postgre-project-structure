# Project-Structure App API

Backend service that powers the **mobile/web application** side of Project-Structure. Built with NestJS, PostgreSQL + Drizzle ORM in a modular, feature-oriented layout.

This repository lives in a monorepo next to `project-structure-admin-api`, `project-structure-database`, etc.

---

## Tech Stack

| Layer             | Library / Tool | Version |
|-------------------|----------------|---------|
| Runtime           | Node.js        | >= 18   |
| Framework         | NestJS         | 11.x    |
| Database          | PostgreSQL     | 14+     |
| ORM / Migrations  | Drizzle ORM / Drizzle-Kit | ^0.44 |
| Real-time         | Socket.IO      | 4.8.x   |
| Video Calls       | Agora Token SDK| 2.x     |
| Payments          | Stripe         | 19.x    |
| Package manager   | pnpm           | ^8.x    |
| Lint / Format     | ESLint, Prettier |       |
| Testing           | Jest           | ^30.x   |

---

## Prerequisites

* Node.js **18+** and **pnpm** installed (`npm i -g pnpm`).
* PostgreSQL instance and connection string.

---

## Getting Started

```bash
# 1. Install dependencies (also links shared project-structure-database package)
pnpm install

# 2. Copy environment variables template
copy .env.example .env
# Edit .env with DB credentials, Stripe keys, etc.

# 3. Generate SQL and apply migrations
pnpm run db:gen-and-migrate

# 4. Boot the API in dev-watch mode
pnpm run dev
```

Service listens at `http://localhost:3001` (default) and Swagger UI is served at `/docs`.

---

## Useful Scripts

| Command                 | Description                      |
|-------------------------|----------------------------------|
| `dev`                   | Start Nest in watch-mode         |
| `build`                 | TS ➜ JS compile                  |
| `start` / `start:prod`  | Run compiled app                 |
| `format` / `format:check` | Prettier write / check         |
| `lint` / `lint:check`   | ESLint fix / check               |
| `db:generate`           | Create migration SQL             |
| `db:migrate`            | Apply pending migrations         |
| `db:studio`             | Visual DB explorer               |
| `test`, `test:watch`    | Run Jest once / watch            |

---

## Folder Structure (abridged)

```
project-structure-app-api/
├── src/
│   ├── app.module.ts       # Root Nest module
│   ├── common/             # Pipes, guards, filters, DTO helpers
│   ├── config/             # ConfigService + validation
│   ├── database/           # Drizzle connection & repos
│   ├── modules/            # Feature modules (v1/*)
│   │   └── v1/
│   │       ├── auth/
│   │       ├── profile/
│   │       ├── payment/    # Stripe flows
│   │       ├── call/       # Agora token issuance
│   │       └── ...others
│   ├── cronjobs/           # Scheduled tasks
│   ├── notification/       # Email / push helpers
│   ├── i18n/               # Translations
│   └── utils/              # Shared helpers
└── drizzle/                # SQL migrations & meta
```

---

## Environment Variables

Refer to `.env.example` for full list. Key ones include:

* `DATABASE_URL` – PostgreSQL connection string
* `JWT_SECRET` – JWT signing secret
* `STRIPE_SECRET_KEY` – Payment processing
* `AGORA_APP_ID`, `AGORA_APP_CERTIFICATE` – Video call tokens
* `AWS_*` – S3 uploads (optional)
* `SENTRY_DSN` – Error tracking (optional)

---

## API Documentation

OpenAPI docs auto-generated by `@nestjs/swagger` are available at `/docs` once the app starts.

---

## Deployment

Stateless build; provide env vars and Postgres. Example Dockerfile:

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY . .
RUN pnpm install --prod && pnpm run build
CMD ["node", "dist/main.js"]
```

Apply database migrations separately or at boot via `pnpm run db:migrate`.

---

## Contributing

1. Fork / create branch `git checkout -b feat/your-feature`.
2. `pnpm install`
3. Ensure `pnpm run lint:check && pnpm run test` pass.
4. Submit pull request.

---

## License

UNLICENSED – proprietary code. All rights reserved.

---

> Made with ♥︎ & NestJS by Jignesh Karena
