# Project-Structure Database Package

**Shared Drizzle ORM schema**, PostgreSQL migrations, and seed utilities used by both `project-structure-admin-api` and `project-structure-app-api` services.

Publishing the package allows the API services to import a single dependency for entities & migrations while keeping the database logic in one place.

---

## Features

- Centralised TypeScript **entities & relations** defined with Drizzle ORM DSL.
- **SQL migrations** generated by `drizzle-kit` committed under `drizzle/`.
- Lightweight **seed scripts** for local/dev environments.
- Can be installed as a local file dependency (`file:..\\project-structure-database`) or from an internal registry.

---

## Tech Stack

| Purpose            | Library / Tool   | Version |
|--------------------|------------------|---------|
| ORM / schema DSL   | Drizzle ORM      | ^0.44   |
| Migrations         | Drizzle-Kit CLI  | ^0.31   |
| Database           | PostgreSQL       | 14+     |
| Language           | TypeScript       | ^5.9    |
| Lint / Format      | ESLint, Prettier |         |

---

## Folder Layout

```
project-structure-database/
├── src/
│   ├── index.ts           # Export entities & helpers
│   ├── schema/            # Drizzle table definitions
│   │   ├── user.ts
│   │   ├── session.ts
│   │   └── ...
│   └── seed/              # Seeders for dev
│       ├── index.ts
│       └── *.ts
├── drizzle/               # auto-generated SQL and meta
│   ├── migrations/*.sql
│   └── meta/_journal.json
├── dist/                  # Compiled js (built on publish)
└── package.json
```

---

## Getting Started (Local Dev)

```bash
# 1. Install dependencies
pnpm install

# 2. (Optional) copy env and set DATABASE_URL
cp .env.example .env

# 3. Generate migration SQL from latest schema
pnpm run db:generate

# 4. Apply migrations to database
pnpm run db:migrate

# 5. (Optional) open visual studio for database
pnpm run db:studio
```

> `drizzle-kit` needs `DATABASE_URL` env variable. For localhost use:
>
> `postgres://user:pass@localhost:5432/project_structure`

---

## Usage in Other Packages

After building/publishing, APIs can import types:

```ts
import { users, sessions } from 'project-structure-database';

const result = await db.select().from(users);
```

The package also exports a helper to create a Drizzle client:

```ts
import { createDb } from 'project-structure-database';

const db = createDb(process.env.DATABASE_URL!);
```

---

## Publishing (internal registry / npm-link)

1. Ensure version bump in `package.json`.
2. Run `pnpm run app` to lint, format, and compile TypeScript.
3. `npm publish --access restricted` (or your internal registry command).

---

## Seed Data

Run `node dist/seed/index.js` (after build) or `ts-node src/seed/index.ts` to insert dev fixtures.

---

## License

UNLICENSED – proprietary code. All rights reserved.

---

> Maintained with ♥︎ by Jignesh Karena
